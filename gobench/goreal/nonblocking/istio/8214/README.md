
# GoReal

| Bug ID|  Ref | Patch | Type | SubType | SubsubType |
| ----  | ---- | ----  | ---- | ---- | ---- |
|[istio#8214]|[pull request]|[patch]| NonBlocking | Traditional | Data Race |

[istio#8214]:(istio8214_test.go)
[patch]:https://github.com/istio/istio/pull/8214/files
[pull request]:https://github.com/istio/istio/pull/8214
 

## Backtrace

```
Write at 0x00c000ce19b0 by goroutine 2118:
  sync/atomic.AddInt64()
      /usr/local/go/src/runtime/race_amd64.s:276 +0xb
  istio.io/istio/pkg/cache.(*lruCache).SetWithExpiration()
      /go/src/istio.io/istio/pkg/cache/lruCache.go:253 +0x5ea
  istio.io/istio/pkg/cache.(*lruWrapper).SetWithExpiration()
      <autogenerated>:1 +0x8f
  istio.io/istio/mixer/pkg/checkcache.(*Cache).Set()
      /go/src/istio.io/istio/mixer/pkg/checkcache/cache.go:191 +0x5ff
  istio.io/istio/mixer/pkg/api.(*grpcServer).check()
      /go/src/istio.io/istio/mixer/pkg/api/grpcServer.go:159 +0x13a1
  istio.io/istio/mixer/pkg/api.(*grpcServer).Check()
      /go/src/istio.io/istio/mixer/pkg/api/grpcServer.go:108 +0x306
  istio.io/istio/vendor/istio.io/api/mixer/v1._Mixer_Check_Handler()
      /go/src/istio.io/istio/vendor/istio.io/api/mixer/v1/service.pb.go:88 +0x2fc
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).processUnaryRPC()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:1026 +0xaf4
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).handleStream()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:1252 +0x1337
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:699 +0xc8

Previous read at 0x00c000ce19b0 by goroutine 2119:
  istio.io/istio/pkg/cache.(*lruCache).Stats()
      /go/src/istio.io/istio/pkg/cache/lruCache.go:311 +0x5d
  istio.io/istio/pkg/cache.(*lruWrapper).Stats()
      <autogenerated>:1 +0x77
  istio.io/istio/mixer/pkg/checkcache.(*Cache).recordStats()
      /go/src/istio.io/istio/mixer/pkg/checkcache/cache.go:196 +0x6b
  istio.io/istio/mixer/pkg/checkcache.(*Cache).Set()
      /go/src/istio.io/istio/mixer/pkg/checkcache/cache.go:192 +0x610
  istio.io/istio/mixer/pkg/api.(*grpcServer).check()
      /go/src/istio.io/istio/mixer/pkg/api/grpcServer.go:159 +0x13a1
  istio.io/istio/mixer/pkg/api.(*grpcServer).Check()
      /go/src/istio.io/istio/mixer/pkg/api/grpcServer.go:108 +0x306
  istio.io/istio/vendor/istio.io/api/mixer/v1._Mixer_Check_Handler()
      /go/src/istio.io/istio/vendor/istio.io/api/mixer/v1/service.pb.go:88 +0x2fc
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).processUnaryRPC()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:1026 +0xaf4
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).handleStream()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:1252 +0x1337
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:699 +0xc8

Goroutine 2118 (running) created at:
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).serveStreams.func1()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:697 +0xb8
  istio.io/istio/vendor/google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/internal/transport/http2_server.go:432 +0x1537
  istio.io/istio/vendor/google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/internal/transport/http2_server.go:472 +0x39f
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).serveStreams()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:695 +0x19a
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).handleRawConn.func2()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:649 +0x53
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).handleRawConn.func3()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:657 +0x34

Goroutine 2119 (finished) created at:
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).serveStreams.func1()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:697 +0xb8
  istio.io/istio/vendor/google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/internal/transport/http2_server.go:432 +0x1537
  istio.io/istio/vendor/google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/internal/transport/http2_server.go:472 +0x39f
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).serveStreams()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:695 +0x19a
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).handleRawConn.func2()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:649 +0x53
  istio.io/istio/vendor/google.golang.org/grpc.(*Server).handleRawConn.func3()
      /go/src/istio.io/istio/vendor/google.golang.org/grpc/server.go:657 +0x34
```

